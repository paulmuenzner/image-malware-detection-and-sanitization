import os
import os.path
import sys

sys.path.append(
    os.path.abspath(
        os.path.join(
            os.path.dirname(__file__), os.path.pardir, os.path.pardir, os.path.pardir
        )
    )
)
import pytest

from data.signature_list_png import PNG_SIGNATURES
from utils.filter_lib_by_keys import filter_lib_by_keys


# --------------- filter_lib_by_keys with png --------------------------------
@pytest.mark.parametrize(
    "signatures, keys, expected",
    [
        (
            PNG_SIGNATURES,
            ["IDAT"],
            {"IDAT": "73, 68, 65, 84"},
        ),
        (
            PNG_SIGNATURES,
            ["IDAT", "PLTE"],
            {"IDAT": "73, 68, 65, 84", "PLTE": "80, 76, 84, 69"},
        ),
        (
            PNG_SIGNATURES,
            ["gAMA", "zTXt", "PLTE"],
            {
                "gAMA": "103, 65, 77, 65",
                "zTXt": "122, 84, 88, 116",
                "PLTE": "80, 76, 84, 69",
            },
        ),
    ],
)
def test_filter_lib_by_keys(signatures, keys, expected):
    result = filter_lib_by_keys(signatures, keys)
    assert (
        result == expected
    ), f"Expected {expected}, but got {result} for keys '{keys}'"
