import traceback

from utils.read_file import read_file
from utils.signature_list_png import PNG_SIGNATURES

chunk_definitions = PNG_SIGNATURES


def check_chunk_occurrences(image_path):
    try:
        image_data = read_file(image_path)
        if isinstance(image_data, str):
            return {"error": image_data}

        occurrences = {}

        for chunk_name, chunk_info in chunk_definitions.items():
            signature = chunk_info["signature"]
            number = chunk_info["number"]
            occurrence_type = chunk_info["occurrence"]

            if occurrence_type == "exact":
                count = image_data.count(bytes(signature))
            else:
                # Handle other occurrence types if needed
                count = 0

            occurrences[chunk_name] = {
                "number": number,
                "occurrences": count,
            }

        return occurrences

    except Exception as e:
        traceback.print_exc()
        return {"error": f"Error processing image: {e}"}


# Example usage:
image_path = "src/assets/test.png"
occurrences = check_chunk_occurrences(image_path)
print(occurrences)
